<!DOCTYPE html>






































<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #faf6f1"
  lang="en-us"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>MVP究极进化 - My New Hugo Site</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="MVP究极进化 MVP demo
graph TD; A(View) --&gt; B(Presenter); B --&gt; C(Model); C --&gt; B; B --&gt; A; MVP通过一个在view与model层中间架设一个presenter层，实现view与model的解耦，这样数据的归数据，界面的归界面。
对于Android而言，Activity就只作为view存在，只需要知道自己要怎么更新UI就好了，不需要知道如何请求数据等操作，而model只管请求数据等操作，他们中间靠一个presenter连接，互相不需要知道对方的存在。
这样做的好处显而易见，就是解耦，但是坏处就是，从以前mvc的一个类变成至少三个类，如果产品设计规范设计的好，修改起来也是很容易，但是如果产品规范设计的不好，就会陷入频繁更改，而且更改时候会更繁琐。
为了能更好的绑定View、Model和Presenter三者的关系，我们通常还会需要一个第四者——Contact。这样做的目的，是为了编码方便，能一目了然的看出到底是那些View、Model和Presenter存在“契约”关系。
public interface IUserContact { public interface IUserView { void showUser(User user); } public interface IUserPresenter&lt;IUserView, IUserModel&gt; { } public interface IUserModel { void getUser(); } } 一般结构如上，一目了然的，通过IUserContact将IUserView、IUserPresenter和IUserModel绑定了起来，注意其中的IUserPresenter的泛型结构。
上边只显示了一组与User有关的mvp结构，如果又有其他的mvp结构呢？我们为了能够更好的适应不同场景，会把M、V、P三方进行抽象，如下：
public interface IView { Context getContext(); } public interface IModel { } public interface IPresenter&lt;V extends IView, M extends IModel&gt; { void attachView(V v); void detachView(); V getView(); } 所以上面的User相关的mvp结构应该改成如下：" />
  <meta name="author" content="" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://boybeak.github.io/main.min.css" />

  

  
  
  
    
  
  <link
    rel="preload"
    as="image"
    href="https://boybeak.github.io/theme.png"
  />

  
  
  
  <link rel="preload" as="image" href="https://www.gravatar.com/avatar/6fd8df4abe41f17fd8e2dd7d97b5cc8c?s=160&amp;d=identicon" />
  
  

  
  <link rel="preload" as="image" href="https://boybeak.github.io/twitter.svg" />
  
  <link rel="preload" as="image" href="https://boybeak.github.io/github.svg" />
  
  <link rel="preload" as="image" href="https://boybeak.github.io/instagram.svg" />
  
  <link rel="preload" as="image" href="https://boybeak.github.io/rss.svg" />
  

  
  <link rel="icon" href="https://boybeak.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://boybeak.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.101.0" />

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="MVP究极进化" />
<meta property="og:description" content="MVP究极进化 MVP demo
graph TD; A(View) --&gt; B(Presenter); B --&gt; C(Model); C --&gt; B; B --&gt; A; MVP通过一个在view与model层中间架设一个presenter层，实现view与model的解耦，这样数据的归数据，界面的归界面。
对于Android而言，Activity就只作为view存在，只需要知道自己要怎么更新UI就好了，不需要知道如何请求数据等操作，而model只管请求数据等操作，他们中间靠一个presenter连接，互相不需要知道对方的存在。
这样做的好处显而易见，就是解耦，但是坏处就是，从以前mvc的一个类变成至少三个类，如果产品设计规范设计的好，修改起来也是很容易，但是如果产品规范设计的不好，就会陷入频繁更改，而且更改时候会更繁琐。
为了能更好的绑定View、Model和Presenter三者的关系，我们通常还会需要一个第四者——Contact。这样做的目的，是为了编码方便，能一目了然的看出到底是那些View、Model和Presenter存在“契约”关系。
public interface IUserContact { public interface IUserView { void showUser(User user); } public interface IUserPresenter&lt;IUserView, IUserModel&gt; { } public interface IUserModel { void getUser(); } } 一般结构如上，一目了然的，通过IUserContact将IUserView、IUserPresenter和IUserModel绑定了起来，注意其中的IUserPresenter的泛型结构。
上边只显示了一组与User有关的mvp结构，如果又有其他的mvp结构呢？我们为了能够更好的适应不同场景，会把M、V、P三方进行抽象，如下：
public interface IView { Context getContext(); } public interface IModel { } public interface IPresenter&lt;V extends IView, M extends IModel&gt; { void attachView(V v); void detachView(); V getView(); } 所以上面的User相关的mvp结构应该改成如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://boybeak.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/mvp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-03T21:03:05+08:00" />
<meta property="article:modified_time" content="2022-09-03T21:03:05+08:00" />


  
  <meta itemprop="name" content="MVP究极进化">
<meta itemprop="description" content="MVP究极进化 MVP demo
graph TD; A(View) --&gt; B(Presenter); B --&gt; C(Model); C --&gt; B; B --&gt; A; MVP通过一个在view与model层中间架设一个presenter层，实现view与model的解耦，这样数据的归数据，界面的归界面。
对于Android而言，Activity就只作为view存在，只需要知道自己要怎么更新UI就好了，不需要知道如何请求数据等操作，而model只管请求数据等操作，他们中间靠一个presenter连接，互相不需要知道对方的存在。
这样做的好处显而易见，就是解耦，但是坏处就是，从以前mvc的一个类变成至少三个类，如果产品设计规范设计的好，修改起来也是很容易，但是如果产品规范设计的不好，就会陷入频繁更改，而且更改时候会更繁琐。
为了能更好的绑定View、Model和Presenter三者的关系，我们通常还会需要一个第四者——Contact。这样做的目的，是为了编码方便，能一目了然的看出到底是那些View、Model和Presenter存在“契约”关系。
public interface IUserContact { public interface IUserView { void showUser(User user); } public interface IUserPresenter&lt;IUserView, IUserModel&gt; { } public interface IUserModel { void getUser(); } } 一般结构如上，一目了然的，通过IUserContact将IUserView、IUserPresenter和IUserModel绑定了起来，注意其中的IUserPresenter的泛型结构。
上边只显示了一组与User有关的mvp结构，如果又有其他的mvp结构呢？我们为了能够更好的适应不同场景，会把M、V、P三方进行抽象，如下：
public interface IView { Context getContext(); } public interface IModel { } public interface IPresenter&lt;V extends IView, M extends IModel&gt; { void attachView(V v); void detachView(); V getView(); } 所以上面的User相关的mvp结构应该改成如下："><meta itemprop="datePublished" content="2022-09-03T21:03:05+08:00" />
<meta itemprop="dateModified" content="2022-09-03T21:03:05+08:00" />
<meta itemprop="wordCount" content="524">
<meta itemprop="keywords" content="untagged," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MVP究极进化"/>
<meta name="twitter:description" content="MVP究极进化 MVP demo
graph TD; A(View) --&gt; B(Presenter); B --&gt; C(Model); C --&gt; B; B --&gt; A; MVP通过一个在view与model层中间架设一个presenter层，实现view与model的解耦，这样数据的归数据，界面的归界面。
对于Android而言，Activity就只作为view存在，只需要知道自己要怎么更新UI就好了，不需要知道如何请求数据等操作，而model只管请求数据等操作，他们中间靠一个presenter连接，互相不需要知道对方的存在。
这样做的好处显而易见，就是解耦，但是坏处就是，从以前mvc的一个类变成至少三个类，如果产品设计规范设计的好，修改起来也是很容易，但是如果产品规范设计的不好，就会陷入频繁更改，而且更改时候会更繁琐。
为了能更好的绑定View、Model和Presenter三者的关系，我们通常还会需要一个第四者——Contact。这样做的目的，是为了编码方便，能一目了然的看出到底是那些View、Model和Presenter存在“契约”关系。
public interface IUserContact { public interface IUserView { void showUser(User user); } public interface IUserPresenter&lt;IUserView, IUserModel&gt; { } public interface IUserModel { void getUser(); } } 一般结构如上，一目了然的，通过IUserContact将IUserView、IUserPresenter和IUserModel绑定了起来，注意其中的IUserPresenter的泛型结构。
上边只显示了一组与User有关的mvp结构，如果又有其他的mvp结构呢？我们为了能够更好的适应不同场景，会把M、V、P三方进行抽象，如下：
public interface IView { Context getContext(); } public interface IModel { } public interface IPresenter&lt;V extends IView, M extends IModel&gt; { void attachView(V v); void detachView(); V getView(); } 所以上面的User相关的mvp结构应该改成如下："/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href="https://boybeak.github.io/"
      >My New Hugo Site</a
    >
    <a
      class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"
    ></a>
  </div>

  <a
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
  ></a>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#faf6f1"`.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const darkVal = localStorage.getItem('dark');
    setDark(darkVal ? darkVal === 'true' : darkScheme.matches);

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href=" https://twitter.com/YOUR_TWITTER_ID "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href=" https://github.com/YOUR_GITHUB_ID "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./instagram.svg)"
        href=" https://instagram.com/YOUR_INSTAGRAM_ID "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href=" https://boybeak.github.io/index.xml "
        target="_blank"
      ></a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"
    >
      

<article>
  <header class="mb-20">
    <h1 class="!my-0 pb-2.5">MVP究极进化</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Sep 3, 2022</time>
      
      
    </div>
    
  </header>

  <section><h1 id="mvp究极进化">MVP究极进化</h1>
<p><a href="https://github.com/boybeak/MVP">MVP demo</a></p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD;
	A(View) --&gt; B(Presenter);
	B --&gt; C(Model);
	C --&gt; B;
	B --&gt; A;
</code></pre><p>MVP通过一个在<strong>view</strong>与<strong>model</strong>层中间架设一个<strong>presenter</strong>层，实现view与model的解耦，这样<em>数据的归数据，界面的归界面</em>。</p>
<p>对于Android而言，Activity就只作为view存在，只需要知道自己要怎么更新UI就好了，不需要知道如何请求数据等操作，而model只管请求数据等操作，他们中间靠一个presenter连接，互相不需要知道对方的存在。</p>
<p>这样做的好处显而易见，就是解耦，但是坏处就是，从以前mvc的一个类变成至少三个类，如果产品设计规范设计的好，修改起来也是很容易，但是如果产品规范设计的不好，就会陷入频繁更改，而且更改时候会更繁琐。</p>
<p>为了能更好的绑定View、Model和Presenter三者的关系，我们通常还会需要一个第四者——<strong>Contact</strong>。这样做的目的，是为了编码方便，能一目了然的看出到底是那些View、Model和Presenter存在“契约”关系。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserContact</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserView</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">showUser</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserPresenter</span><span style="color:#f92672">&lt;</span>IUserView<span style="color:#f92672">,</span> IUserModel<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserModel</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getUser</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>一般结构如上，一目了然的，通过IUserContact将IUserView、IUserPresenter和IUserModel绑定了起来，注意其中的IUserPresenter的泛型结构。</p>
<p>上边只显示了一组与User有关的mvp结构，如果又有其他的mvp结构呢？我们为了能够更好的适应不同场景，会把M、V、P三方进行抽象，如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IView</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  Context <span style="color:#a6e22e">getContext</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IModel</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IPresenter</span><span style="color:#f92672">&lt;</span>V <span style="color:#66d9ef">extends</span> IView<span style="color:#f92672">,</span> M <span style="color:#66d9ef">extends</span> IModel<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">attachView</span><span style="color:#f92672">(</span>V v<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">detachView</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  V <span style="color:#a6e22e">getView</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>所以上面的User相关的mvp结构应该改成如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserContact</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserView</span> <span style="color:#66d9ef">extends</span> IView<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">showUser</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserModel</span> <span style="color:#66d9ef">extends</span> IModel<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IUserPresenter</span><span style="color:#f92672">&lt;</span>IUserView<span style="color:#f92672">,</span> IUserModel<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getUser</span><span style="color:#f92672">(){...}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>其实，IPresenter的那几个方法，几乎每个Presenter实现类，几乎都差不多，所以我们封装一个BasePresenter类，将这几个基本方法实现了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasePresenter</span><span style="color:#f92672">&lt;</span>V <span style="color:#66d9ef">extends</span> IView<span style="color:#f92672">,</span> M <span style="color:#66d9ef">extends</span> IModel<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">implements</span> IPresenter<span style="color:#f92672">&lt;</span>V<span style="color:#f92672">,</span> M<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> V view<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> M model<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">attachView</span><span style="color:#f92672">(</span>V v<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">view</span> <span style="color:#f92672">=</span> v<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> <span style="color:#f92672">...;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">detachView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">view</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> V <span style="color:#a6e22e">getView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> view<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>这样，上面的IUserPresenter继承BasePresenter后就可以专心做获取user的工作了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IUserPresenter</span><span style="color:#f92672">&lt;</span>IUserView<span style="color:#f92672">,</span> IUserModel<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> BasePresenter<span style="color:#f92672">&lt;</span>IUserView<span style="color:#f92672">,</span> IUserModel<span style="color:#f92672">&gt;{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getUser</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      asyncGetUser<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> OnUserGetListener<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onGetUser</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>getView<span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getView<span style="color:#f92672">().</span><span style="color:#a6e22e">showUser</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">})</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>这样每个Presenter类就专注于自己的业务就好了，可是这里还是有问题：<strong>内存泄漏</strong>与<strong>频繁空判断</strong>。</p>
<p>想象这样一个场景，IUserPresenter中不止有获取用户基本信息的操作，还有获取个人主页的最近照片、最近状态等操作，那每次等到结果时候，都要进行<code>getView != null</code>的判断，因为可能用户在刚刚进入这个界面，没有等到网络请求结果，又马上退出去了，这样view就被detachView方法置空了。</p>
<p>那如果view不置为null行不行？<strong>当然不行</strong>，这会引起内存泄漏的。</p>
<p>接下来的改造，目的就明确了，<strong>避免内存泄漏</strong>+<strong>避免频繁空判断</strong>。要实现这样的目的，需要引入动态代理。我们对BasePresenter类进行进一步改造。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasePresenter</span><span style="color:#f92672">&lt;</span>V <span style="color:#66d9ef">extends</span> IView<span style="color:#f92672">,</span> M <span style="color:#66d9ef">extends</span> IModel<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">implements</span> IPresenter<span style="color:#f92672">&lt;</span>V<span style="color:#f92672">,</span> M<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String TAG <span style="color:#f92672">=</span> BasePresenter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> WeakReference<span style="color:#f92672">&lt;</span>V<span style="color:#f92672">&gt;</span> viewReference<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> V proxyView<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">attachView</span><span style="color:#f92672">(</span>V v<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        viewReference <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> WeakReference<span style="color:#f92672">&lt;&gt;(</span>v<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        proxyView <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>V<span style="color:#f92672">)</span> Proxy<span style="color:#f92672">.</span><span style="color:#a6e22e">newProxyInstance</span><span style="color:#f92672">(</span>v<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">(),</span> v<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getInterfaces</span><span style="color:#f92672">(),</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> InvocationHandler<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Object proxy<span style="color:#f92672">,</span> Method method<span style="color:#f92672">,</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        Log<span style="color:#f92672">.</span><span style="color:#a6e22e">v</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;run by proxy&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>viewReference <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> viewReference<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">return</span> method<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>viewReference<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(),</span> args<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">detachView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        viewReference<span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        viewReference <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> V <span style="color:#a6e22e">getView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> proxyView<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>通过<strong>动态代理</strong>，我们会先判断原始view是否为空，不为空，则通过view去执行相对应的方法，这样就规避了频繁的空判断，同时又可以避免activity的内存泄漏。</p>
<p>接下来我们开始对model开刀，我们为<strong>BasePresenter</strong>通过<strong>反射</strong>自动创建model。修改后如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasePresenter</span><span style="color:#f92672">&lt;</span>V <span style="color:#66d9ef">extends</span> IView<span style="color:#f92672">,</span> M <span style="color:#66d9ef">extends</span> IModel<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">implements</span> IPresenter<span style="color:#f92672">&lt;</span>V<span style="color:#f92672">,</span> M<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String TAG <span style="color:#f92672">=</span> BasePresenter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> WeakReference<span style="color:#f92672">&lt;</span>V<span style="color:#f92672">&gt;</span> viewReference<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> V proxyView<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> M m<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">attachView</span><span style="color:#f92672">(</span>V v<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        viewReference <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> WeakReference<span style="color:#f92672">&lt;&gt;(</span>v<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        proxyView <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>V<span style="color:#f92672">)</span> Proxy<span style="color:#f92672">.</span><span style="color:#a6e22e">newProxyInstance</span><span style="color:#f92672">(</span>v<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">(),</span> v<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getInterfaces</span><span style="color:#f92672">(),</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> InvocationHandler<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Object proxy<span style="color:#f92672">,</span> Method method<span style="color:#f92672">,</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        Log<span style="color:#f92672">.</span><span style="color:#a6e22e">v</span><span style="color:#f92672">(</span>TAG<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;run by proxy&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>viewReference <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> viewReference<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">return</span> method<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>viewReference<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(),</span> args<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ParameterizedType type <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ParameterizedType<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getGenericSuperclass</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>type <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Type<span style="color:#f92672">[]</span> types <span style="color:#f92672">=</span> type<span style="color:#f92672">.</span><span style="color:#a6e22e">getActualTypeArguments</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                m <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>M<span style="color:#f92672">)((</span>Class<span style="color:#f92672">&lt;?&gt;)</span>types<span style="color:#f92672">[</span>1<span style="color:#f92672">]).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IllegalAccessException <span style="color:#f92672">|</span> InstantiationException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">detachView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        viewReference<span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        viewReference <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> V <span style="color:#a6e22e">getView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> proxyView<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> M <span style="color:#a6e22e">getModel</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> m<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>主要是为BasePresenter添加了getModel方法，为了让view层无法感知到model，需要将这个方法的修饰符设置为<code>protected</code>。重点方法还是在attachView方法中，动态代理下边的代码，我们通过反射，生成了这个model对象，当然，这样做也比较局限，就是model类必须有一个空的构造方法才行。</p>
<p><strong>既然model可以通过反射来生成，那么presenter能否通过反射来生成呢？<strong>当然也可以！我们创建一个Annotation类——</strong>@AutoPresenter</strong>，来标记需要自动生成的类。</p>
<p>再创建一个BaseActivity如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseActivity</span><span style="color:#f92672">&lt;</span>P <span style="color:#66d9ef">extends</span> IPresenter<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> AppCompatActivity <span style="color:#66d9ef">implements</span> IView <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> P presenter<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        presenter <span style="color:#f92672">=</span> findPresenter<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        presenter<span style="color:#f92672">.</span><span style="color:#a6e22e">attachView</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onDestroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onDestroy</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        presenter<span style="color:#f92672">.</span><span style="color:#a6e22e">detachView</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> P <span style="color:#a6e22e">findPresenter</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Field<span style="color:#f92672">[]</span> fields <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDeclaredFields</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>fields <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Field f <span style="color:#f92672">:</span> fields<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>f<span style="color:#f92672">.</span><span style="color:#a6e22e">getAnnotation</span><span style="color:#f92672">(</span>AutoPresenter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        P p <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>P<span style="color:#f92672">)</span>f<span style="color:#f92672">.</span><span style="color:#a6e22e">getType</span><span style="color:#f92672">().</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                        f<span style="color:#f92672">.</span><span style="color:#a6e22e">setAccessible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        f<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> p<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> p<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IllegalAccessException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InstantiationException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> P <span style="color:#a6e22e">getPresenter</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> presenter<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>在findPresenter方法中，通过反射生成了presenter的对象，这样做的缺点也是显而易见的，就是presenter类必须有一个无参数构造对象。</p>
<p>如果不想用注解反射的方式，也可以参考demo项目中的BaseMVPActivity。</p>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://boybeak.github.io/tags/untagged"
      >untagged</a
    >
    
  </footer>
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a class="flex w-1/2 items-center p-6 pr-3 no-underline" href="https://boybeak.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/mvc/"
      ><span class="mr-1.5">←</span><span>MVC</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline"
      href="https://boybeak.github.io/posts/android/mavencentral/"
      ><span>发布Android库到MavenCentral教程</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  

  
  
  <div id="disqus_thread"></div>
  <script>
    const disqusShortname = 'YOUR_DISQUS_SHORTNAME';
    const script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
  
</article>


    </main>

    <footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60">
  <div class="mr-auto">
    &copy; 2022
    <a class="link" href="https://boybeak.github.io/">My New Hugo Site</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank">Powered by Hugo️️</a
  >️
  <a class="link" href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank"
    >▷ Paper 6</a
  >
</footer>

  </body>
</html>
